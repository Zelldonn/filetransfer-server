Airdroid.Module.TestFileTransfer=Airdroid.Util.extend(Airdroid.Base,{events:{"click .addFileItem":"addFileItemHandle","click .addImgItem":"addImgItemHandle","click .itemProgressSubmit":"updateFileProgress","click .itemSpeedSubmit":"updateFileSpeed","click .changeStateSubmit":"changeFileState","click .changeActionSubmit":"fileOperate","click .clearAllItemSubmit":"clearAll","click .changeFilterSubmit":"showFilter","click .loadMoreFile":"loadMoreFile","click .changeToAttrSubmit":"changeToAttrSubmit","click .changeFromAttrSubmit":"changeFromAttrSubmit","click .startDel":"setDel","click .delSelectItem":"delSelectItem","click .saveDayItem":"saveDayItem","click .triggerFace":"triggerFace","click .addClipboardMsg":"addClipboardMsg","click .clipboardMsgOperate":"clipboardMsgOperate"},defaultFileOpt:{icon:"../../img/icon/fm_icon_default.png",type:"1",name:"",date:"",size:"120KB",state:"3",from:"1",to:"2",saveDay:"6"},defaultTextOpt:{icon:"../../img/icon/fm_icon_txt.png",type:"2",body:"",date:"",from:"1",to:"2"},clipboardMsgs:[],_construct:function(){var a=this,b=0;Airdroid.Util.addPCInterface({fileAction:function(b){var c=JSON.parse(b),d=c.id,e=c.operation;switch(e.toString()){case a.pcApi.fileAction.action.del:PC_API(a.parentModuleName+"_fileOperate",{id:d,operation:"1"});break;case a.pcApi.fileAction.action.open:alert("");break;case a.pcApi.fileAction.action.openFolder:alert("");break;case a.pcApi.fileAction.action.copy:alert("");break;case a.pcApi.fileAction.action.save:alert("");break;case a.pcApi.fileAction.action.cancelUpload:PC_API(a.parentModuleName+"_setFileState",{id:d,state:"5"});break;case a.pcApi.fileAction.action.stopUpload:alert("");break;case a.pcApi.fileAction.action.restartUpload:PC_API(a.parentModuleName+"_setFileState",{id:d,state:"1"});break;case a.pcApi.fileAction.action.download:alert("")}},textAction:function(b){var c=JSON.parse(b),d=c.id,e=c.operation,f=c.content;switch(e.toString()){case a.pcApi.textAction.action.openLink:alert(":"+f);break;case a.pcApi.textAction.action.copy:alert(":"+f);break;case a.pcApi.textAction.action.search:alert("Google:"+f);break;case a.pcApi.textAction.action.del:PC_API(a.parentModuleName+"_fileOperate",{id:d,operation:"1"})}},askFileUploadData:function(c){var d=JSON.parse(c),e=d.time||(new Date).getTime(),f=parseInt(d.count),g=d.order,h={list:[],order:g,time:e},i="",j=function(b,c){for(var d=0;f>d;d++){"1"==b?i=c+36e5*(d+1):"0"==b&&(i=c-36e5*(f-d+1));var e={id:a.getUniqId(),date:i,body:_.uniqueId(""),from:[1,2][d%2]};h.list.push($.extend(!0,{},a.defaultTextOpt,e))}};0===parseInt(e)?j("1",a._data):"1"==g?j("1",e):"0"==g&&j("0",e),b+=1,b>3&&(h.list=[]),PC_API(a.parentModuleName+"_addFileItems",h)},clipboardAction:function(b){var c=JSON.parse(b),d=a.clipboardMsgs[c.id].operation;PC_API(a.parentModuleName+"_clipboardMsgOperate",{id:c.id,operation:d}),setTimeout(function(){PC_API(a.parentModuleName+"_clipboardMsgOperate",{id:c.id,operation:"10"===d?"11":"1"})},1e3)}})},getRefDom:function(){return this._refDOM},onCreate:function(a){var b=this;this.parentModule=a,this.parentModuleName=a.moduleName,this._refDOM=this.containDom=$(b.util.getTemplate("Test","Common/fileTransfer"))},getUniqId:function(){return Math.floor(1e7*Math.random())},addFileItemHandle:function(){var a={};a.id=this.getUniqId(),a.date=(new Date).getTime();var b=this.find(".itemType").val();a.type=b;var c=this.find(".itemFrom").val();"1"==c?(a.from="1",a.to="2"):(a.from="2",a.to="1"),a.state=parseInt(this.find(".itemState").val()),1==b||3==b?(a.name=this.find(".itemName").val(),3==b&&(a.name=""),this.addFileItem(a)):(a.body=this.find(".itemName").val(),this.addTextItem(a))},addImgItemHandle:function(){var a={};a.id=this.getUniqId(),a.date=(new Date).getTime();a.type=1;var b=this.find(".itemFrom").val();"1"==b?(a.from="1",a.to="2"):(a.from="2",a.to="1"),a.state=parseInt(this.find(".itemState").val());var c=this.find(".imgType").val().split(",");a.icon="../../../test-tmp/img"+c[0]+"."+c[3],a.imgWidth=c[1],a.imgHeight=c[2],a.name=".png",this.addFileItem(a)},addFileItem:function(a){var a=a||{};PC_API(this.parentModuleName+"_addFileItems",{list:[$.extend(!0,{},this.defaultFileOpt,a)],order:1,time:0})},addTextItem:function(a){var a=a||{};PC_API(this.parentModuleName+"_addFileItems",{list:[$.extend(!0,{},this.defaultTextOpt,a)],order:1,time:0})},updateFileProgress:function(a){var b=$(a.currentTarget).parent().find(".itemProgress").val(),c=$(".fileTransfer-list-item .item-progress-bar:visible").closest(".fileTransfer-list-item");if(b&&c.length>0){var d=$(c.get(0)).attr("data-file-id");PC_API(this.parentModuleName+"_updateFileProgress",{id:d,progress:b})}},updateFileSpeed:function(a){var b=$(a.currentTarget).parent().find(".itemSpeed").val(),c=$(".fileTransfer-list-item .item-progress-bar:visible").closest(".fileTransfer-list-item");if(b&&c.length>0){var d=$(c.get(0)).attr("data-file-id");PC_API(this.parentModuleName+"_updateFileSpeed",{id:d,speed:b})}},changeFileState:function(a){var b=$(a.currentTarget).parent().find(".changeItemState").val(),c=$(".fileTransfer-list-item");if(c.length>0){var d=$(c.get(0)).attr("data-file-id");PC_API(this.parentModuleName+"_setFileState",{id:d,state:b})}},fileOperate:function(a){var b=$(a.currentTarget).parent().find(".changeItemAction").val(),c=$(".fileTransfer-list-item");if(c.length>0){var d=$(c.get(0)).attr("data-file-id");PC_API(this.parentModuleName+"_fileOperate",{id:d,operation:b})}},clearAll:function(a){PC_API(this.parentModuleName+"_clearAll")},showFilter:function(a){var b=$(a.currentTarget).parent().find(".changeItemFilter").val(),c=$(a.currentTarget).parent().find(".changeOtherFilter").val();b&&PC_API(this.parentModuleName+"_showFilter",{filter:b,filter_ext:c})},changeNetwork:function(){PC_API(this.parentModuleName+"_networkChanged",{disconnect:$(".changeItemNetwork").val()})},loadMoreFile:function(){var a=this,b=this.find(".itemOrder").val();if("1"===b)var c=parseInt($(".fileTransfer-list-item:last").attr("data-date"));else var c=parseInt($(".fileTransfer-list-item:first").attr("data-date"));this.util.triggerPCInterface(JSON.stringify({action:a.pcApi.askFileUploadData.name,time:c,count:10,order:b}))},changeToAttrSubmit:function(){var a=this,b=this.find(".changeToAttr").val(),c=$(".fileTransfer-list-item:first").attr("data-file-id");PC_API(a.parentModuleName+"_changeFileAttribute",{id:c,to:b})},changeFromAttrSubmit:function(){var a=this,b=this.find(".changeFromAttr").val(),c=$(".fileTransfer-list-item:first").attr("data-file-id");PC_API(a.parentModuleName+"_changeFileAttribute",{id:c,from:b})},setDel:function(a){var b=$(a.currentTarget).attr("data-type");PC_API(this.parentModuleName+"_setDel",{type:b}),$(a.currentTarget).attr("data-type","1"==b?"0":"1")},delSelectItem:function(){var a=[];$(".fileTransfer-list-item.item-checked").each(function(){a.push($(this).attr("data-file-id"))}),PC_API(this.parentModuleName+"_fileOperate",{id:a,operation:"1"})},saveDayItem:function(){var a=this.find(".saveDaySelect").val(),b=$(".fileTransfer-list-item:first").attr("data-file-id");PC_API(this.parentModuleName+"_changeFileAttribute",{id:b,saveDay:a})},triggerFace:function(){var a=$(".fileTransfer-list-item:first");if(a.length>0)var b=1,c=setInterval(function(){if(b>100)clearInterval(c);else{b+=2;var d=$(a.get(0)).attr("data-file-id");PC_API(this.parentModuleName+"_updateFileProgress",{id:d,progress:b})}},500)},addClipboardMsg:function(a){var b=this,c=_.uniqueId(),d=$(a.currentTarget).attr("data-operation");PC_API(this.parentModuleName+"_addClipboardMsgItem",{id:c,type:d}),this.clipboardMsgs[c]={id:c,operation:d},setTimeout(function(){PC_API(b.parentModuleName+"_clipboardMsgOperate",{id:c,operation:"10"===d?"12":"2"})},500)},clipboardMsgOperate:function(a){PC_API(this.parentModuleName+"_clipboardMsgOperate",{id:"1",operation:$(a.currentTarget).attr("data-operation")})}}),Airdroid.Module.TestFileUpload=Airdroid.Util.extend(Airdroid.Base,{events:{},_construct:function(){Airdroid.Util.addPCInterface({triggerPageLoaded:function(a){var b=JSON.parse(a);0===b.isInit&&PC_API("Common_initEnv",{lang:"zh-cn"})}})},onCreate:function(a){var b=this;this.parentModule=a,this._refDOM=this.containDom=$(b.util.getTemplate("Test",a.moduleName));var c=new Airdroid.Module.TestFileTransfer;c.createAppView(a),this._refDOM.append(c.getRefDom()),a.setTestApiContent(this._refDOM)}});var FileTransfer;FileTransfer=Airdroid.Util.extend(Airdroid.Base,{scrollbarStickBottom:!0,FILE_STATE:{uploading:"1",failed:"2",successed:"3",connecting:"4",canceled:"5",uploadWaiting:"6",getOfflineResult:"7",waitingDownload:"8"},FILE_TYPE:{file:"1",text:"2",folder:"3"},FILE_ACTION:{del:"1",cancel:"2",stop:"3",restart:"4"},FILE_FILTER:{showAll:"1",onlyText:"2",onlyFrom:"3",onlyTo:"4",filter:"99"},TIME_TIP:{NO_SIGN:"1",SIGN:"2",NETWORK:"3",FRIEND:"4",HISTORY:"5",AIRDROID:"6",CLIPBOARD:"7"},CLIPBOARD_MSG:{LOADING:"0",SUCCESS:"1",FAIL:"2",EMPTY:"3",LOADING_TO_PC:"10",SUCCESS_TO_PC:"11",FAIL_TO_PC:"12",EMPTY_TO_PC:"13"},imgExt:["png","jpg","gif","jpeg","bmp","tif","tiff"],FILE_FROM:{PC:"1",Mobile:"2",Cloud:"3"},PAGE_COUNT:10,events:{"click .item-opt-file .item-action":"fileActionHandle","click .item-img-restart":"fileActionHandle","click .item-opt-text .item-action":"textActionHandle","click .fileTransfer-list-item .restart":"fileActionHandle","mouseenter .fileTransfer-list-item .item-content":"itemMouseEnterHandle","mouseleave .fileTransfer-list-item .item-content":"itemMouseLeaveHandle","click a.linkable":"linkClickHandle","click .item-checkbox":"itemCheckClickHandle","dblclick .item-content":"listItemDoubleClickHandle","click .item-more-tip":"showLoadMoreHandle","click .timeTip .item-type-text-7 .icon-fail":"resendClipboard"},_isLoadingData:null,MAX_COUNT:90,_delItemArr:[],_isCurrentDelState:!1,_hasHistory:!0,IMG_MAXWIDTH:160,IMG_MAXHEIGHT:160,IMG_MINWIDTH:40,IMG_MINHEIGHT:40,_construct:function(){},onCreate:function(){var a=this;this._refDOM=$(a.util.getTemplate("Common","file_transfer/index")),this.shouldTriggerPageLoaded=!1,this._fileAdded=!0,this.hasShowMoreLoadTip=!0},getDom:function(a){return a?this._refDOM.find(a):this._refDOM},onCreateAfter:function(a,b){this.parentModule=a,this._listDom=this._refDOM=a.find(".fileTransfer-list"),this.containDom=this._refDOM,b.width&&this.setBodySize({width:b.width,height:b.height}),this.initScrollApi()},checkIsImageType:function(a){return this.imgExt.indexOf(a.split(".").pop().toLowerCase())>-1},addTimeTip:function(a,b,c,d){if(d=d||_.uniqueId(),0==this.find(".timeTip-type-"+a).length||a===this.TIME_TIP.CLIPBOARD){var e=this.util.getTemplate("Common","time_tip",{id:d||_.uniqueId("timeTip_"),type:a,name:c||this.curName||"xxx"});b||(e=this.createTimeline((new Date).getTime(),null,null,!0)+e),this._scrollApi.getContentPane().append(e),this.resizeConWhenAddAfter(),this.hideErrorState()}},fileActionHandle:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".fileTransfer-list-item"),e=d.attr("data-file-id"),f=c.attr("data-cmd"),g=b.pcApi.fileAction.action[f];return g&&this.util.triggerPCInterface(JSON.stringify({action:b.pcApi.fileAction.name,id:e,operation:g})),!1},fixIEUserSelectBug:function(a){var b=this;this.util.checkIsIE()&&(a=_.isArray(a)?a:[a],_.each(a,function(a){var c=b.getItemDom(a);c.length>0&&c.find(".item-text").each(function(){var a=$(this);if("none"==a.css("display"))a.text()&&(a.attr("data-text",a.text().trim()),a.text(""));else{var b=a.attr("data-text");b&&""!==b.trim()&&a.text(b.trim())}})}))},textActionHandle:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".fileTransfer-list-item"),e=d.attr("data-file-id"),f=c.attr("data-cmd"),g=d.find(".item-body span").text(),h=b.pcApi.textAction.action[f];h&&this.util.triggerPCInterface(JSON.stringify({action:b.pcApi.textAction.name,id:e,operation:h,content:g}))},linkClickHandle:function(a){this.util.triggerNavigating(a)},listItemDoubleClickHandle:function(a){var b=$(a.currentTarget);return"none"!==b.find(".openFolder").css("display")&&b.find(".open").length>0?(b.find(".open").trigger("click"),!1):void 0},itemMouseEnterHandle:function(a){},itemMouseLeaveHandle:function(a){},itemCheckClickHandle:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".fileTransfer-list-item");d.hasClass("item-checked")?(d.removeClass("item-checked"),b._delItemArr=_.without(b._delItemArr,d.attr("data-file-id"))):(d.addClass("item-checked"),b._delItemArr.push(d.attr("data-file-id"))),this.util.triggerPCInterface(JSON.stringify({action:b.pcApi.getSelectDelFiles.name,data:b._delItemArr}))},removeItem:function(a){var b=a.prev(".timeline");a.remove(),this.removeTimeline(b)},getItemDom:function(a){return this.find(".fileTransfer-list-item[data-file-id='"+a+"']")},getImageItemSize:function(a){if(a.imgWidth&&a.imgHeight){var b=parseInt(a.imgWidth),c=parseInt(a.imgHeight),d=Math.min(b,this.IMG_MAXWIDTH),e=Math.min(c,this.IMG_MAXHEIGHT),f=parseFloat((b/c).toFixed(4));if(f>=1){if(e=Math.max(d/f,1),d<this.IMG_MINWIDTH||e<this.IMG_MINHEIGHT){var g=parseFloat((this.IMG_MINHEIGHT/e).toFixed(4));d=Math.min(d*g,this.IMG_MAXWIDTH),e=this.IMG_MINHEIGHT}}else if(d=Math.max(e*f,1),d<this.IMG_MINWIDTH||e<this.IMG_MINHEIGHT){var g=parseFloat((this.IMG_MINWIDTH/d).toFixed(4));e=Math.min(e*g,this.IMG_MAXHEIGHT),d=this.IMG_MINWIDTH}return d+="px",e+="px","width:"+d+";height:"+e+";"}return""},loadMore:function(){var a=this,b=a._listDom.find(".fileTransfer-list-item:first").attr("data-date")||"1";a._isLoadingData=b,a.showLoadingFlag(),setTimeout(function(){a.util.triggerPCInterface(JSON.stringify({action:a.pcApi.askFileUploadData.name,time:b,count:a.PAGE_COUNT,order:0}))},200)},resendClipboard:function(a){var b=$(a.currentTarget).parents(".timeTip"),c=b.attr("data-id"),d=b.attr("data-type"),e=b.attr("data-initial-operation");this.util.triggerPCInterface(JSON.stringify({action:this.pcApi.clipboardAction.name,operation:this.pcApi.clipboardAction.action.resend,type:d,id:c})),this.clipboardMsgOperate({id:c,operation:e})},scrollHandle:function(a,b,c,d){var e=this;c&&!e._isLoadingData&&e._hasHistory&&!e.isScrollTriggerAuto()&&e.loadMore()},showLoadMoreHandle:function(){this.loadMore()},resizeItemContent:function(){var a=this._listDom.find(".fileTransfer-list-item"),b=a.length-this.MAX_COUNT;if(b>0){var c=a.filter(":eq("+(b+this.PAGE_COUNT)+")");c.prevAll(".fileTransfer-list-item,.timeline").remove(),this._hasHistory=!0}},hideScrollLoadingMask:function(){var a=this;a._isLoadingData=null,a.hideLoadingFlag()},resizeConWhenAddAfter:function(a,b){this.resizeItemContent(),this.reinitScrollbar(),(a||b&&"1"==b.pop().from)&&this._scrollApi.scrollToBottom(!1)},getItemParam:function(a){return JSON.parse(decodeURIComponent(a.attr("data-str")))},setItemParam:function(a,b){a.attr("data-str",encodeURIComponent(JSON.stringify(b)))},fixImageItemScrollBugWhenIE:function(){var a=this;if(this.util.checkIsIE())var b=1,c=this._listDom.find(".fileTransfer-list-item:last"),d=$("body").height(),e=setInterval(function(){b>2?clearInterval(e):c.offset().top+c.height()+35>d?(a.reinitScrollbar(),clearInterval(e)):b+=1},100)},isEmpty:function(){return this._listDom.find(".timeTip, .fileTransfer-list-item").length<=0},showErrorState:function(a){_.isFunction(this.parentModule.onShowErrorState)&&this.parentModule.onShowErrorState(a)},hideErrorState:function(){_.isFunction(this.parentModule.onHideErrorState)&&this.parentModule.onHideErrorState()},getTimeTip:function(a){return $("#timeTip_"+a)},getClipboardState:function(a){var b={0:{name:"loading",text:Airdroid.Lang.time_tip_7},1:{name:"success",text:Airdroid.Lang.time_tip_7_done},2:{name:"fail",text:Airdroid.Lang.time_tip_7_fail},3:{name:"empty",text:Airdroid.Lang.time_tip_7_empty},10:{name:"loading",text:Airdroid.Lang.time_tip_7_2},11:{name:"success",text:Airdroid.Lang.time_tip_7_2_done},12:{name:"fail",text:Airdroid.Lang.time_tip_7_2_fail},13:{name:"empty",text:Airdroid.Lang.time_tip_7_2_empty}};return b[a]},addFileItems:function(a){this._scrollApi.calculateNeedGoBottom();var b=this,c=a.list;b._hasHistory&&(b._hasHistory=c.length>0),b._fileAdded&&(c.length<b.PAGE_COUNT&&(b._hasHistory=!1),b._fileAdded=!1);var d=parseInt(a.time);d&&b._isLoadingData==d&&b.hideScrollLoadingMask();var e=this._listDom.find(".fileTransfer-list-item"),f=this.isEmpty();if(c.length>0)b.hideErrorState();else{if(f&&0==b.find(".timeTip").length)return void b.showErrorState(this.config.ERRORCODE.empty);if(b._listDom.find(".fileTransfer-list-item:not([data-file-id=welcome_text])").length>0)return void this.util.showDelayMsg($("body"),this.lang.no_history_file)}var g=12e5,h=a.order.toString()||"1",i="1"==h,j=!1,k="",l=[];_.each(c,function(a,h){l.push(a.id);var m=b.getRelativeDate(c,h,f,e,d),n=!1;switch(i||0!=h||b.checkNeedCreateTimeLine(a.date,m,g)||(n=!0),k+=b.createTimeline(a.date,m,g,n),a.type.toString()){case b.FILE_TYPE.file:var o=!1;a.isImage=!1,b.checkIsImageType(a.name)&&(a.from==b.FILE_FROM.PC||a.state==b.FILE_STATE.successed?(o=!0,j=!0):a.isImage=!0),o&&(a.itemSize=b.getImageItemSize(a)),k+=b.util.getTemplate("Common",o?"file_transfer/img_item":"file_transfer/file_item",{item:a}).trim();break;case b.FILE_TYPE.folder:k+=b.util.getTemplate("Common","file_transfer/file_item",{item:a}).trim();break;case b.FILE_TYPE.text:a.body=b.util.linkify(a.body.escapeHTML()),k+=b.util.getTemplate("Common","file_transfer/text_item",{item:a}).trim()}}),b._hasHistory?b.showMoreLoadTip(null,!0):b.hideMoreLoadTip();var m=$(k);if(f||0===d)this._scrollApi.getContentPane().append(m),this.resizeConWhenAddAfter(f,c),f&&j&&this.fixImageItemScrollBugWhenIE();else if("1"==h){var n=e.filter("[data-date='"+d+"']");n.nextAll(".fileTransfer-list-item,.timeline").remove(),n.after(m),this.resizeConWhenAddAfter(f,c)}else if("0"==h&&c.length>0){var n=e.filter("[data-date='"+d+"']"),o=n.prev();o.hasClass("timeline")&&b.checkNeedCreateTimeLine(parseInt(n.attr("data-date")),parseInt(c.pop().date),g)&&(n=o),n.prevAll(".fileTransfer-list-item,.timeline,.timeTip").remove(),n.before(m),b._scrollApi.scrollToElement(n,!0),this.reinitScrollbar()}b.checkIsCurrentDelState(),b.checkLongStrAndBreak(m.filter(".item-file-type-2")),setTimeout(function(){b.hanldeWordWrap(m.find(".item-name,.i-user-select-text"),300)},30),b.fixIEUserSelectBug(l),_.isFunction(b.parentModule.onAdd)&&b.parentModule.onAdd()},fileOperate:function(a){var b=this,c=a.id;_.isArray(c)||(c=[c]);var d=a.operation;switch(d.toString()){case b.FILE_ACTION.del:_.each(c,function(a){var c=b.getItemDom(a);b.removeItem(c)}),0==b._listDom.find(".fileTransfer-list-item").length&&b.loadMore(),b.reinitScrollbar()}},updateFileProgress:function(a){var b=a.id,c=a.progress,d=this.getItemDom(b);if(d.length>0)if(c=parseInt(c),c=0>c?0:c,c=c>100?100:c,d.hasClass("item-file-img")){d.find(".item-img-progress-value").text(c+"%");var e=d.find(".item-img-mask");!e.data("parent_h")&&e.data("parent_h",e.parent().height()),this.util.browser.ie?e.css("height",(100-c)/100*parseInt(e.data("parent_h"))+"px"):e.css({height:100-c+"%"})}else d.find(".item-progress-value").width(c+"%")},updateFileSpeed:function(a){var b=a.id,c=a.speed,d=this.getItemDom(b);d.length>0&&d.find(".item-upload-speed-container").text("("+c+")")},setFileState:function(a){var b=this,c=a.id,d=a.state,e=this.getItemDom(c);if(!(e.length<=0)){var f=e.attr("class"),g=f.replace(/item-state-([\d]+? {0,1})(-\S*)?/g,"item-state-"+d+"$2 ");e.attr("class",g);var h=!0;switch(d.toString()){case b.FILE_STATE.getOfflineResult:b.updateFileProgress({id:c,progress:100});break;case b.FILE_STATE.successed:if(e.attr("data-str")){var i=b.getItemParam(e);i.state=d,b._scrollApi.calculateNeedGoBottom(),h=!1,i.itemSize=b.getImageItemSize(i),e.get(0).outerHTML=b.util.getTemplate("Common","file_transfer/img_item",{item:i}).trim()}}setTimeout(function(){b.reinitScrollbar(null,h)},0),this.fixIEUserSelectBug(c)}},clearAll:function(){this._scrollApi.getContentPane().empty(),this.hideErrorState(),this.showLoadingMask(null,!0),this.reinitScrollbar(),this.hideScrollLoadingMask(),this._data=null,this._hasHistory=!0,this._fileAdded=!0},networkChanged:function(a){var b=this;"1"==a.disconnect?(b.hideErrorState(),b.addTimeTip(b.TIME_TIP.NETWORK,!0),this._scrollApi.scrollToBottom(!1)):(b.find(".timeTip-type-3").remove(),this.reinitScrollbar())},changeFileAttribute:function(a){var b,c,d=this,e=a.id,f=this.getItemDom(e);if(!(f.length<=0)){if(a.icon&&(f.find(".item-img").attr("src",a.icon.escapeHTML()),f.attr("data-str"))){var g=d.getItemParam(f);g=$.extend(!0,{},g,a),d.setItemParam(f,g)}a.to&&(b=f.attr("class"),c=b.replace(/item-to-[\d]+? {0,1}/g,"item-to-"+a.to+" ").replace(/item-state(\S*)-to-[\d]+? {0,1}(-\S*)?/g,"item-state$1-to-"+a.to+"$2 "),f.attr("class",c)),a.from&&(b=f.attr("class"),c=b.replace(/item-from-[\d]+? {0,1}/g,"item-from-"+a.from+" ").replace(/item-state(\S*)-from-[\d]+? {0,1}(-\S*)?/g,"item-state$1-from-"+a.from+"$2 "),f.attr("class",c)),a.saveDay&&(f.find(".item-upload-state-text-cloud-to-3").text(Airdroid.Lang.accept_from_cloud.format(a.saveDay||7)),f.find(".item-upload-state-text-cloud-from-3").text(Airdroid.Lang.accept_from_cloud.format(a.saveDay||7)),b=f.attr("class"),c=b.replace(/item-state(\S*)-save-(\S*)/g,"item-state$1-save-"+a.saveDay+" "),f.attr("class",c)),this.reinitScrollbar(),this.fixIEUserSelectBug(e)}},setDel:function(a){this._isCurrentDelState="1"==a.type,this.checkIsCurrentDelState(),this.reinitScrollbar()},checkIsCurrentDelState:function(){var a=this;this._isCurrentDelState||(this._listDom.find(".fileTransfer-list-item").removeClass("item-checked"),a._delItemArr=[],this.util.triggerPCInterface(JSON.stringify({action:a.pcApi.getSelectDelFiles.name,data:a._delItemArr}))),this._listDom.find(".fileTransfer-list-item .item-checkbox").css("display",this._isCurrentDelState?"inline":"none")},showFilter:function(a){var b=this,c=a.filter,d=a.filter_ext,e=this._listDom.find(".fileTransfer-list-item");switch(c){case b.FILE_FILTER.showAll:e.show();break;case b.FILE_FILTER.onlyText:e.filter("[data-file-type=1]").hide(),e.filter("[data-file-type=3]").hide(),e.filter("[data-file-type=2]").show();break;case b.FILE_FILTER.onlyFrom:e.filter(".item-from-1").hide(),e.filter(".item-from-2").show(),e.filter(".item-from-3").show();break;case b.FILE_FILTER.onlyTo:e.filter(".item-from-2").hide(),e.filter(".item-from-3").hide(),e.filter(".item-from-1").show();break;case b.FILE_FILTER.filter:if(d){var f=d.split(",");e.filter("[data-file-type=2]").hide(),e.filter("[data-file-type=3]").hide(),e.filter("[data-file-type=1]").each(function(){var a=$(this).find(".item-name").text(),b=a.split(".");if(b.length>1){var c=b.length-1;f.indexOf(b[c])>-1?$(this).show():$(this).hide()}})}}},addClipboardMsgItem:function(a){var b,c;b=a.id,this.addTimeTip(this.TIME_TIP.CLIPBOARD,!1,name,b),c=this.getTimeTip(a.id),c.attr("data-initial-operation",a.type),this.clipboardMsgOperate({id:a.id,operation:a.type||this.CLIPBOARD_MSG.LOADING}),this._scrollApi.scrollToBottom()},clipboardMsgOperate:function(a){var b,c,d;b=this.getTimeTip(a.id),c=b.find(".icon"),d=this.getClipboardState(a.operation),"empty"===d.name?c.hide():c.show().removeClass("icon-loading icon-success icon-fail").addClass("icon-"+d.name),b.attr("data-type",a.operation),b.find(".content").text(d.text)}}),Airdroid.Module.FileUpload=Airdroid.Util.extend(Airdroid.Base,{moduleName:Airdroid.Config.Module.FileUpload,events:{},_construct:function(){},onCreate:function(){var a=this;if(this.clear(),this._refDOM=$(a.util.getTemplate("FileUpload","index")),this.fileTransferHelp=new FileTransfer,this.fileTransferHelp.createAppView(this),this._refDOM.append(this.fileTransferHelp.getDom()),this.setContent(this._refDOM,{noScroll:!0}),_.isFunction(this.fileTransferHelp.onCreateAfter)&&this.fileTransferHelp.onCreateAfter(this,{width:this._width,height:this._height}),this.config.isDebug){var b=new Airdroid.Module["Test"+this.moduleName];b.createAppView(this)}var c={addFileItems:"addFileItems",fileOperate:"fileOperate",updateFileProgress:"updateFileProgress",updateFileSpeed:"updateFileSpeed",setFileState:"setFileState",clearAll:"clearAll",showFilter:"showFilter",changeFileAttribute:"changeFileAttribute",setDel:"setDel",addClipboardMsgItem:"addClipboardMsgItem",clipboardMsgOperate:"clipboardMsgOperate"};this.registerWebInterface(c),_.each(c,function(b,c){_.isFunction(a.fileTransferHelp[b])&&(a[b]=a.fileTransferHelp[b].bind(a.fileTransferHelp))}),this.showLoadingMask(null,!0)},onResize:function(a){this.fileTransferHelp.renderView(a)},onShowErrorState:function(){this.showErrorStateTip.apply(this,arguments)},onHideErrorState:function(){this.hideErrorStateTip.apply(this,arguments)}});