Airdroid.Module.TestSysNotification=Airdroid.Util.extend(Airdroid.Base,{events:{"click .addNotification":"addNotificationHandle","click .setState0":"setState0","click .setState1":"setState1","click .setState2":"setState2","click .setState3":"setState3","click .clear":"clear","click .update":"update"},defaultOpt:{list:[{id:"0",icon:"../../img/notice_default.jpg",title:"",body:"Google play  http://www.airdroid.com airdroid55@test_cc.com",type:"0",date:"2015-02-13 20:20"},{id:"1",icon:"",type:"1",title:"",body:"Cathy (airdroid55@test_cc.com)",email:"airdroid55@test_cc.com",state:"0",date:"2015-02-13 20:20"},{id:"2",icon:"../../img/notice_default.jpg",type:"1",title:"",body:"Cathy (tuqiaoying@gmail.com)",email:"airdroid55@test_cc.com",state:"1",date:"2015-02-13 20:20"},{id:"3",icon:"../../img/notice_default.jpg",type:"1",title:"",body:"Cathy (airdroid55@test_cc.com)",email:"tuqiaoying@gmail.com",state:"2",date:"2015-02-13 20:20"},{id:"4",icon:"../../img/notice_default.jpg",type:"2",title:"",body:"sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample 。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。",url:"http://www.airdroid.com",state:"2",date:"2015-02-13 20:20"}]},_construct:function(){var a=this,b=0;Airdroid.Util.addPCInterface({triggerPageLoaded:function(a){var b=JSON.parse(a);0===b.isInit&&PC_API("Common_initEnv",{lang:"es"})},notificationAction:function(a){a=JSON.parse(a),PC_API("SysNotification_notificationOperate",a)},friendAction:function(a){a=JSON.parse(a),a.state=a.operation,a.id=1,a.state=3,PC_API("SysNotification_setNotificationState",a),setTimeout(function(){Math.random()>.4?a.state=4:a.state=a.operation,PC_API("SysNotification_setNotificationState",a)},1e3)},triggerNavigating:function(a){a=JSON.parse(a),window.open(a.url)},askNotificationData:function(){setTimeout(function(){var c={};_.forEach(this.defaultOpt,function(b){b.id=a.getUniqId()}),c=$.extend(!0,{},a.defaultOpt,c),b>=3&&(c.list=[]),PC_API("SysNotification_addNotificationItems",c)},1e3)}})},onCreate:function(a){var b=this;this.parentModule=a,this._refDOM=this.containDom=$(b.util.getTemplate("Test",a.moduleName)),a.setTestApiContent(this._refDOM)},getUniqId:function(){return Math.floor(1e7*Math.random())},addNotificationHandle:function(){var a=this,b={};_.forEach(this.defaultOpt,function(b){b.id=a.getUniqId()}),a.addNotificationItems($.extend(!0,{},this.defaultOpt,b))},addNotificationItems:function(a){PC_API("SysNotification_addNotificationItems",a)},setState0:function(){PC_API("SysNotification_setNotificationState",{id:"3",state:"0"})},setState1:function(){PC_API("SysNotification_setNotificationState",{id:"3",state:"1"})},setState2:function(){PC_API("SysNotification_setNotificationState",{id:"3",state:"2"})},setState3:function(){PC_API("SysNotification_setNotificationState",{id:"3",state:"3"})},clear:function(){PC_API("SysNotification_clearAll")},update:function(){PC_API("SysNotification_updateNotification",{id:"3",icon:"../../img/round-gray-hover.png",type:"1",title:"",body:"Cathy (tuqiaoying@gmail.com)",email:"tuqiaoying@gmail.com",state:"2",date:"2015-02-13 20:20"})}}),Airdroid.Module.SysNotification=Airdroid.Util.extend(Airdroid.Base,{moduleName:Airdroid.Config.Module.SysNotification,NOTIFICATION_ACTION:{del:0},_currPage:1,PAGE_SIZE:20,events:{"click a.linkable":"linkClickHandle","click .item-accept":"acceptFriend","click .item-reject":"rejectFriend","click .item-retry":"retryFriendAction","click .item-del":"deleteNotification","mouseover .item-sys-notification":"addHover","mouseout .item-sys-notification":"removeHover","click .item-open-url":"openUrl"},_construct:function(){},onCreate:function(){var a=this;if(this.clear(),this._refDOM=$(a.util.getTemplate("SysNotification","index")),this.setContent(this._refDOM),this.setBodyHeight(616),this._detailDom=this.find(".mod-SysNotification-body"),this.config.isDebug){var b=new Airdroid.Module["Test"+this.moduleName];b.createAppView(this)}this.registerWebInterface({addNotificationItems:"addNotificationItems",setNotificationState:"setNotificationState",notificationOperate:"notificationOperate",updateNotification:"addNotificationItems",clearAll:"clearAll"}),this.showLoadingMask(null,!0)},onResize:function(){var a=$("html").width()-120,b=".item-content-body";Airdroid.Util.checkIsLtIE8()&&(b=".cc",a-=50),this.checkLongStrAndBreak(this.find(".item-body"),b,a,!1)},linkClickHandle:function(a){this.util.triggerNavigating(a)},deleteNotification:function(a){var b=this,c=$(a.currentTarget).parents(".item-sys-notification");b.util.triggerPCInterface(JSON.stringify({id:c.attr("data-id"),action:b.pcApi.notificationAction.name,operation:b.pcApi.notificationAction.action.del}))},acceptFriend:function(a){var b=this,c=$(a.currentTarget).parents(".item-sys-notification");b.util.triggerPCInterface(JSON.stringify({id:c.attr("data-id"),email:c.attr("data-email"),action:b.pcApi.friendAction.name,operation:b.pcApi.friendAction.action.accept})),this.currFriendAction="accept"},rejectFriend:function(a){var b=this,c=$(a.currentTarget).parents(".item-sys-notification");b.util.triggerPCInterface(JSON.stringify({id:c.attr("data-id"),email:c.attr("data-email"),action:b.pcApi.friendAction.name,operation:b.pcApi.friendAction.action.reject})),this.currFriendAction="reject"},retryFriendAction:function(a){"accept"===this.currFriendAction?this.acceptFriend(a):this.rejectFriend(a)},openUrl:function(a){var b=this,c=$(a.currentTarget).parents(".item-sys-notification");b.util.triggerPCInterface(JSON.stringify({action:b.pcApi.triggerNavigating.name,url:c.attr("data-url")}))},buildNotificationItem:function(a){var b;return a.icon||(1==a.type?a.icon="../../img/avatar.png":a.icon="../../img/round-gray-hover.png"),1!=a.type?a.body=this.util.linkify(a.body.escapeHTML()):a.body=a.body.escapeHTML(),b=$(this.util.getTemplate("SysNotification","detail",{item:a}).trim()),b.attr("data-id",a.id),b.attr("data-email",a.email),b.attr("data-url",a.url),b[0].outerHTML},onScrollToBottom:function(a,b){!this._isLoadingData&&this._hasHistory&&this.showNextPage()},showNextPage:function(){this.showPage(this._currPage+1,"append")},showPage:function(a,b){this._currPage=a;var c=this.PAGE_SIZE,d=$.extend({},this._data),e=(a-1)*c;d.list=[],_.each(this._data.list,function(a,b){e>b||d.list.length>=c||d.list.push(a)}),this.showNotificationItem(d,b)},showNotificationItem:function(a,b){var c=this,d="";if(_.each(a.list,function(a){d+=c.buildNotificationItem(a)}),c._detailDom[b](d),$(".item-sys-title").each(function(){var a=$(this);a.height()>21&&a.addClass("multi-line")}),this.reinitScrollbar(),a.list.length<=0){if(!this._data||!this._data.list||this._data.list.length<this.PAGE_SIZE)return;this.util.showDelayMsg($("body"),this.lang.no_history_notification),this._hasHistory=!1}else this._hasHistory=!0},addNotificationItems:function(a){return a.list=a.list||[],a.list.reverse(),this._data?(this.showNotificationItem(a,"prepend"),void this.onResize()):(this._data=a,this.hideLoadingMask(),this.reinitScrollbar(),this._isLoadingData=null,this.hideLoadingFlag(),this.showPage(1,"append"),void this.onResize())},updateNotification:function(a){var b=this.buildNotificationItem(a);$("#notification_"+a.id).replaceWith(b)},setNotificationState:function(a){var b;b=a.id?$("#notification_"+a.id):$('.item-sys-notification[data-email="'+a.email+'"]'),b.removeClass("item-state-0").removeClass("item-state-1").removeClass("item-state-2").removeClass("item-state-3").removeClass("item-state-4").removeClass("item-state-5").addClass("item-state-"+a.state||0)},notificationOperate:function(a){var b=this,c=a.operation;switch(c.toString()){case b.pcApi.notificationAction.action.del:var d=a.id;_.isArray(d)||(d=[d]),_.each(d,function(a){$("#notification_"+a).remove()}),b.reinitScrollbar(),b._scrollApi.isAtBottom()&&b.onScrollToBottom()}},clearAll:function(){$(".mod-SysNotification-body").empty(),this.reinitScrollbar(),this._hasHistory=!0,this._data=null}});