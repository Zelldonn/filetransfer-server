Airdroid.Module.TestNotification=Airdroid.Util.extend(Airdroid.Base,{events:{"click .addNotification":"addNotificationHandle","click .setNotificationFail":"setNotificationFail","click .setAllRead":"setAllRead","click .clearAll":"clearAll"},defaultOpt:{name:"facebook",icon:"../../img/notice_default.jpg",size:"100MB",noDisturb:"0",noList:"0",unreadList:[{id:"00",title:"#a#",body:"Google play ",type:"2",url:"http://www.airdroid.com",date:"2015-02-16 20:20"},{id:"01",title:"",body:"Google play  http://www.airdroid.com",type:"0",date:"2015-02-17 20:30"}],list:[{id:"1",title:"",body:"Google play  http://www.airdroid.com airdroid55@test_cc.com",type:"0",date:"2015-02-15 20:20"},{id:"2",icon:"",type:"1",title:"",body:"Cathy (airdroid55@test_cc.com)",email:"airdroid55@test_cc.com",state:"0",date:"2015-02-14 20:20"},{id:"3",icon:"../../img/notice_default.jpg",type:"1",title:"",body:"Cathy (tuqiaoying@gmail.com)",email:"airdroid55@test_cc.com",state:"1",date:"2015-02-13 20:20"},{id:"4",icon:"../../img/notice_default.jpg",type:"1",title:"",body:"Cathy (airdroid55@test_cc.com)",email:"tuqiaoying@gmail.com",state:"2",date:"2015-02-12 20:20"},{id:"5",icon:"../../img/notice_default.jpg",type:"2",title:"",body:"sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample sample 。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。",url:"http://www.airdroid.com",state:"2",date:"2015-02-11 20:20"}]},_construct:function(){var a=this,b=0;Airdroid.Util.addPCInterface({notificationDisturbSetting:function(a){var b=JSON.parse(a),c=b.noDisturb;PC_API("Notification_setNoDisturb",{noDisturb:c})},appNotificationAction:function(a){a=JSON.parse(a),PC_API("Notification_notificationOperate",a)},askNotificationData:function(){setTimeout(function(){var c={};c=$.extend(!0,{},a.defaultOpt,c),c.id=a.getUniqId(),b>0&&(c.list=[]),PC_API("Notification_addNotificationItems",c),b++},2e3)}})},onCreate:function(a){var b=this;this.parentModule=a,this._refDOM=this.containDom=$(b.util.getTemplate("Test",a.moduleName)),a.setTestApiContent(this._refDOM)},getUniqId:function(){return Math.floor(1e7*Math.random())},addNotificationHandle:function(){var a=this,b={};b.id=this.getUniqId(),a.addNotificationItems($.extend(!0,{},this.defaultOpt,b))},setNotificationFail:function(){PC_API("Notification_setNotificationFail",{sku:"1",noDisturb:"1"})},addNotificationItems:function(a){PC_API("Notification_addNotificationItems",a)},setAllRead:function(){PC_API("Notification_setAllRead")},clearAll:function(){PC_API("Notification_clearAll")}}),Airdroid.Module.Notification=Airdroid.Util.extend(Airdroid.Base,{moduleName:Airdroid.Config.Module.Notification,_currPage:1,PAGE_SIZE:20,events:{"click a.linkable":"linkClickHandle","click .item-body.item-type-2":"clickNotificationHandle","mouseover .item-sys-notification":"addHover","mouseout .item-sys-notification":"removeHover","click a.item-del":"deleteNotification"},_construct:function(){},onCreate:function(){var a=this;if(this.clear(),this._refDOM=$(a.util.getTemplate("Notification","index")),this.setContent(this._refDOM),this.setHeaderHeight(75),this.setBodyHeight(540),this.initHeadDom(),this.$readContainer=this.find(".item-notification-container"),this.$unreadContainer=this.find(".item-unread-notification-container"),this.config.isDebug){var b=new Airdroid.Module["Test"+this.moduleName];b.createAppView(this)}this.registerWebInterface({addNotificationItems:"addNotificationItems",updateNotification:"updateNotification",setNotificationFail:"setNotificationFail",setNoDisturb:"setNoDisturb",notificationOperate:"notificationOperate",setAllRead:"setAllRead",clearAll:"clearAll"}),this.showLoadingMask(null,!0)},initHeadDom:function(){var a=$(this.util.getTemplate("Notification","header",{lang:this.lang}));$("body").prepend(a),a.on("click",".item-disturb-switch",_.bind(this.settingDisturbHandle,this))},onResize:function(a){var b=$("html").width()-120,c=".item-content-body";Airdroid.Util.checkIsLtIE8()&&(c=".cc"),this.checkLongStrAndBreak(this.find(".item-body"),c,b,!1)},settingDisturbHandle:function(a){this.util.triggerPCInterface(JSON.stringify({action:this.pcApi.notificationDisturbSetting.name,id:this._refDOM.attr("data-id"),sku:this._refDOM.attr("data-sku"),noDisturb:$("body").hasClass("item-nodisturb")?"0":"1"})),console.log($("body").hasClass("item-nodisturb")?"0":"1")},clickNotificationHandle:function(a){this.util.triggerNavigating($(a.currentTarget).attr("data-url"))},linkClickHandle:function(a){this.util.triggerNavigating(a)},buildNotificationItem:function(a){var b=encodeURIComponent(JSON.stringify(a));return a.body=this.util.linkify(a.body.escapeHTML()),this.util.getTemplate("Notification","detail",{item:a,originStr:b}).trim()},deleteNotification:function(a){a.stopPropagation();var b=this,c=$(a.currentTarget).parents(".item-sys-notification");b.util.triggerPCInterface(JSON.stringify({id:c.attr("data-id"),action:b.pcApi.appNotificationAction.name,operation:b.pcApi.appNotificationAction.action.del}))},updateTitleVisibility:function(){var a=this._refDOM.find(".item-unread-title"),b=this._refDOM.find(".item-read-title");""==this.$unreadContainer.html()?a.hide():a.show(),""==this.$readContainer.html()?b.hide():b.show()},onScrollToBottom:function(a,b){!this._isLoadingData&&this._hasHistory&&this.showNextPage()},showNextPage:function(){this.showPage(this._currPage+1,"append")},showPage:function(a,b){var c=this;this._currPage=a;var d=this.PAGE_SIZE,e=$.extend({},this._data),f=(a-1)*d;e.unreadList=[],e.list=[],_.each(this._data.unreadList,function(a,b){f>b||e.unreadList.length>=d||e.unreadList.push(a)}),_.each(this._data.list,function(a,b){b+c._data.unreadList.length<f||e.unreadList.length+e.list.length>=d||e.list.push(a)}),this.showNotificationItem(e,b)},updateEmptyTipVisibility:function(){""==this._refDOM.find(".item-unread-notification-container").html()&&""==this._refDOM.find(".item-notification-container").html()?this._refDOM.addClass("empty"):this._refDOM.removeClass("empty")},showNotificationItem:function(a,b){var c=this,d=$("body");b=b||"append";var e="";if(_.each(a.unreadList,function(a){e+=c.buildNotificationItem(a)}),c.$unreadContainer[b](e),e="",_.each(a.list,function(a){e+=c.buildNotificationItem(a)}),c.$readContainer[b](e),this.updateEmptyTipVisibility(),this.updateTitleVisibility(),this.reinitScrollbar(),"1"==a.noDisturb?d.addClass("item-nodisturb"):d.removeClass("item-nodisturb"),"1"==a.noList?d.addClass("item-nolist"):d.removeClass("item-nolist"),this._isLoadingData=null,this.hideLoadingFlag(),a.unreadList.length+a.list.length<=0){if("0"===a.noDisturb&&this._currPage>1){if(!this._data||!this._data.list||this._data.list.length<this.PAGE_SIZE)return;this.util.showDelayMsg($("body"),this.lang.no_history_notification)}this._hasHistory=!1}else this._hasHistory=!0},addNotificationItems:function(a){if(a.unreadList=a.unreadList||[],a.list=a.list||[],a.unreadList.reverse(),a.list.reverse(),this._data)return void this.showNotificationItem(a,"prepend");this._data=a,this._refDOM.attr({"data-id":a.id,"data-sku":a.sku});var b=$("body").find(".item-header");b.removeClass("hide"),b.find(".item-title").text(a.name),b.find(".item-desc").text(a.size),b.find(".item-icon img").attr("src",a.icon),this.hideLoadingMask(),this._refDOM.find(".mod-Notification-body").removeClass("hide"),this.showPage(1,"append")},setNotificationFail:function(a){if(a.sku==this._refDOM.attr("data-sku")){var b=$("body");"1"==a.noDisturb?b.addClass("item-nodisturb"):b.removeClass("item-nodisturb"),this.util.showDelayMsg(b,this.lang.set_fail)}},setNoDisturb:function(a){var b=$("body");"1"==a.noDisturb?b.addClass("item-nodisturb"):b.removeClass("item-nodisturb"),this.reinitScrollbar()},notificationOperate:function(a){var b=this,c=a.operation;switch(c.toString()){case b.pcApi.notificationAction.action.del:var d=a.id;_.isArray(d)||(d=[d]),_.each(d,function(a){$("#notification_"+a).remove()}),b.updateTitleVisibility(),b.updateEmptyTipVisibility(),b.reinitScrollbar(),b._scrollApi.isAtBottom()&&b.onScrollToBottom()}},setAllRead:function(){var a=this;if(this.util.checkIsLtIE8()){var b="";this.$unreadContainer.find(".item-sys-notification").each(function(){$(this).attr("data-origin")&&(b+=a.buildNotificationItem(JSON.parse(decodeURIComponent($(this).attr("data-origin")))))}),this.$readContainer.prepend(b)}else this.$readContainer.prepend(this.$unreadContainer.html().trim());this.$unreadContainer.html(""),this.updateTitleVisibility()},clearAll:function(){$(".item-unread-notification-container").empty(),$(".item-notification-container").empty(),this.updateTitleVisibility(),this.updateEmptyTipVisibility(),this.reinitScrollbar(),this._hasHistory=!0,this._data=null},updateNotification:function(a){}});